<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BM AI Assistant - Text & Image Generation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --primary-light: #5a75f0;
            --secondary: #3f37c9;
            --accent: #4895ef;
            --dark: #2b2d42;
            --light: #f8f9fa;
            --success: #4cc9f0;
            --warning: #f72585;
            --card-bg: #ffffff;
            --shadow: 0 4px 20px rgba(67, 97, 238, 0.15);
            --gradient: linear-gradient(135deg, #4361ee, #3a0ca3);
            --ai-bg: #f0f7ff;
            --user-bg: #4361ee;
            --text-dark: #2b2d42;
            --text-light: #ffffff;
            --border-radius: 16px;
            --input-height: 56px;
            --image-bg: #f9faff;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, Roboto, Oxygen, Ubuntu, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f0f4ff 0%, #e6edff 100%);
            min-height: 100vh;
            padding: 15px;
            color: var(--text-dark);
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 900px;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        /* Header Styles */
        header {
            text-align: center;
            padding: 15px 0 0;
            position: relative;
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .logo-icon {
            width: 54px;
            height: 54px;
            background: var(--gradient);
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.25);
        }
        
        .logo-icon i {
            font-size: 1.8rem;
            color: white;
        }
        
        h1 {
            font-size: 2rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
            letter-spacing: -0.5px;
            font-weight: 800;
            text-shadow: 0 2px 4px rgba(67, 97, 238, 0.1);
        }
        
        .subtitle {
            font-size: 1.05rem;
            color: #5a67d8;
            max-width: 600px;
            margin: 0 auto 20px;
            line-height: 1.5;
            padding: 0 15px;
            font-weight: 500;
        }
        
        /* Mode Selector */
        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .mode-btn {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 50px;
            padding: 10px 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .mode-btn.active {
            background: var(--gradient);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.2);
        }
        
        .mode-btn i {
            font-size: 1.2rem;
        }
        
        /* Chat Container - Fixed Height */
        .chat-container {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
            border: 1px solid rgba(67, 97, 238, 0.15);
            height: 65vh;
        }
        
        .chat-header {
            background: var(--gradient);
            color: white;
            padding: 15px 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .header-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .model-info {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            padding: 8px 16px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .connection-status {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            padding: 8px 16px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        .status-connected {
            background-color: var(--success);
            box-shadow: 0 0 8px var(--success);
        }
        
        .status-disconnected {
            background-color: var(--warning);
            box-shadow: 0 0 8px var(--warning);
        }
        
        .new-chat-btn {
            background: rgba(255, 255, 255, 0.25);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .new-chat-btn:hover {
            background: rgba(255, 255, 255, 0.35);
            transform: translateY(-2px);
        }
        
        /* Chat Messages */
        .chat-messages {
            flex: 1;
            padding: 20px 15px 10px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
            scroll-behavior: smooth;
            background: rgba(248, 249, 250, 0.6);
        }
        
        .message {
            max-width: 85%;
            padding: 18px 20px;
            border-radius: 18px;
            line-height: 1.6;
            position: relative;
            animation: fadeIn 0.4s ease-out;
            box-shadow: var(--shadow);
            font-size: 1.05rem;
            word-wrap: break-word;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            align-self: flex-end;
            background: var(--user-bg);
            color: var(--text-light);
            border-bottom-right-radius: 5px;
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
        }
        
        .ai-message {
            align-self: flex-start;
            background: var(--ai-bg);
            color: var(--text-dark);
            border-bottom-left-radius: 5px;
            position: relative;
            padding-left: 60px;
        }
        
        .ai-avatar {
            position: absolute;
            left: 15px;
            top: 15px;
            width: 36px;
            height: 36px;
            border-radius: 12px;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.1rem;
            box-shadow: 0 2px 6px rgba(67, 97, 238, 0.2);
        }
        
        /* Image Message Styles */
        .image-message {
            align-self: flex-start;
            background: var(--image-bg);
            padding: 15px;
            border-radius: 16px;
            max-width: 90%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .generated-image {
            max-width: 100%;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            background: #f0f4ff;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .generated-image img {
            max-width: 100%;
            max-height: 400px;
            object-fit: contain;
            border-radius: 8px;
        }
        
        .image-placeholder {
            width: 100%;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f0f4ff;
            border-radius: 8px;
            color: var(--primary);
            font-size: 3rem;
        }
        
        .download-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(67, 97, 238, 0.2);
        }
        
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
        }
        
        .image-info {
            font-size: 0.85rem;
            color: #6c757d;
            align-self: flex-start;
            padding: 0 5px;
        }
        
        /* Bold text formatting for emphasized content */
        .ai-message strong {
            color: #3f37c9;
            font-weight: 600;
        }
        
        /* Chat Input */
        .chat-input-container {
            padding: 15px;
            background: white;
            border-top: 1px solid rgba(233, 236, 239, 0.6);
            display: flex;
            gap: 12px;
            position: relative;
        }
        
        .chat-input {
            flex: 1;
            display: flex;
            background: #f0f4ff;
            border-radius: 30px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.15);
            border: 1px solid rgba(67, 97, 238, 0.15);
            transition: all 0.3s ease;
        }
        
        .chat-input:focus-within {
            box-shadow: 0 6px 16px rgba(67, 97, 238, 0.25);
            transform: translateY(-2px);
        }
        
        .chat-input input {
            flex: 1;
            padding: 0 22px;
            border: none;
            background: transparent;
            font-size: 1.05rem;
            outline: none;
            height: var(--input-height);
            color: var(--text-dark);
        }
        
        .chat-input input::placeholder {
            color: #8b9bff;
            font-weight: 500;
        }
        
        .send-btn {
            background: var(--gradient);
            color: white;
            border: none;
            width: var(--input-height);
            height: var(--input-height);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .send-btn:not(:disabled):hover {
            background: var(--primary-light);
            transform: scale(1.05);
        }
        
        .send-btn:disabled {
            background: #c5d0ff;
            cursor: not-allowed;
        }
        
        .send-btn i {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }
        
        .send-btn:not(:disabled):hover i {
            transform: translateX(2px);
        }
        
        /* Example Questions */
        .example-questions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            margin: 15px 0 5px;
            padding: 0 10px;
        }
        
        .example-question {
            background: white;
            border-radius: 14px;
            padding: 14px 18px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(67, 97, 238, 0.1);
            border: 1px solid rgba(67, 97, 238, 0.1);
            text-align: left;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .example-question::before {
            content: "💡";
            font-size: 1.1rem;
        }
        
        .example-question:hover, .example-question:active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 6px 15px rgba(67, 97, 238, 0.3);
            transform: translateY(-3px);
        }
        
        /* Typing Indicator */
        .typing-indicator {
            display: none;
            align-items: center;
            padding: 14px 22px;
            background: var(--ai-bg);
            border-radius: 18px;
            align-self: flex-start;
            gap: 8px;
            margin-left: 60px;
            box-shadow: var(--shadow);
        }
        
        .typing-indicator span {
            height: 10px;
            width: 10px;
            background: var(--accent);
            border-radius: 50%;
            display: inline-block;
            animation: bounce 1.3s infinite;
        }
        
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .image-generating {
            display: none;
            align-items: center;
            padding: 14px 22px;
            background: var(--ai-bg);
            border-radius: 18px;
            align-self: flex-start;
            gap: 8px;
            margin-left: 60px;
            box-shadow: var(--shadow);
        }
        
        /* Error Message */
        .error-message {
            background: #ffecec;
            color: #ff5252;
            padding: 14px 18px;
            border-radius: 14px;
            margin: 10px 0;
            display: none;
            border-left: 4px solid #ff5252;
            font-size: 0.95rem;
            align-self: center;
            max-width: 80%;
            box-shadow: 0 2px 8px rgba(255, 82, 82, 0.15);
        }
        
        /* Scrollbar styling */
        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }
        
        .chat-messages::-webkit-scrollbar-track {
            background: rgba(241, 241, 241, 0.5);
            border-radius: 10px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 10px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
        
        .scroll-indicator {
            position: absolute;
            bottom: 85px;
            right: 25px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(67, 97, 238, 0.3);
        }
        
        .scroll-indicator:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 15px rgba(67, 97, 238, 0.4);
        }
        
        .scroll-indicator.visible {
            opacity: 1;
        }
        
        /* Footer */
        footer {
            text-align: center;
            padding: 15px 0 5px;
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .powered-by {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            color: #6c757d;
            margin-top: 5px;
            font-size: 0.85rem;
        }
        
        /* Mobile-specific styles */
        @media (max-width: 768px) {
            :root {
                --input-height: 50px;
                --border-radius: 16px;
            }
            
            body {
                padding: 10px;
            }
            
            header {
                padding: 10px 0 0;
            }
            
            h1 {
                font-size: 1.7rem;
            }
            
            .logo-icon {
                width: 46px;
                height: 46px;
                border-radius: 14px;
            }
            
            .subtitle {
                font-size: 0.95rem;
            }
            
            .mode-selector {
                gap: 10px;
                margin-bottom: 15px;
            }
            
            .mode-btn {
                padding: 8px 16px;
                font-size: 0.9rem;
            }
            
            .chat-header {
                padding: 12px 15px;
                gap: 10px;
            }
            
            .header-controls {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .model-info, .connection-status, .new-chat-btn {
                font-size: 0.85rem;
                padding: 7px 14px;
            }
            
            .chat-messages {
                padding: 15px 10px 10px;
                gap: 15px;
            }
            
            .message {
                max-width: 90%;
                padding: 16px 18px;
                font-size: 1rem;
            }
            
            .ai-message {
                padding-left: 50px;
            }
            
            .ai-avatar {
                width: 32px;
                height: 32px;
                font-size: 1rem;
                border-radius: 10px;
            }
            
            .chat-input-container {
                padding: 12px;
            }
            
            .example-questions {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .example-question {
                padding: 12px 16px;
                font-size: 0.9rem;
            }
            
            .scroll-indicator {
                bottom: 75px;
                right: 15px;
                width: 32px;
                height: 32px;
            }
            
            .typing-indicator, .image-generating {
                margin-left: 50px;
            }
            
            .generated-image {
                max-width: 90%;
            }
        }
        
        @media (max-width: 480px) {
            :root {
                --input-height: 48px;
            }
            
            h1 {
                font-size: 1.6rem;
            }
            
            .logo {
                gap: 12px;
            }
            
            .logo-icon {
                width: 42px;
                height: 42px;
                border-radius: 12px;
            }
            
            .logo-icon i {
                font-size: 1.5rem;
            }
            
            .mode-btn {
                padding: 7px 14px;
                font-size: 0.85rem;
            }
            
            .example-questions {
                gap: 10px;
            }
            
            .example-question {
                padding: 10px 14px;
                font-size: 0.85rem;
            }
            
            .message {
                max-width: 95%;
            }
            
            .chat-input input {
                padding: 0 18px;
                font-size: 0.95rem;
            }
            
            .ai-message {
                padding-left: 46px;
            }
            
            .ai-avatar {
                width: 30px;
                height: 30px;
                font-size: 0.9rem;
            }
        }
        
        /* Animation Enhancements */
        .message {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .message:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(67, 97, 238, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(67, 97, 238, 0); }
            100% { box-shadow: 0 0 0 0 rgba(67, 97, 238, 0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-robot"></i>
                </div>
                <h1>BM AI Assistant</h1>
            </div>
            <p class="subtitle">Your intelligent assistant for answers and AI image generation</p>
            
            <div class="mode-selector">
                <button id="chat-mode-btn" class="mode-btn active">
                    <i class="fas fa-comments"></i> Text Chat
                </button>
                <button id="image-mode-btn" class="mode-btn">
                    <i class="fas fa-image"></i> Generate Image
                </button>
            </div>
            
            <div class="example-questions">
                <div class="example-question">Explain quantum computing in simple terms</div>
                <div class="example-question">How to make sourdough starter?</div>
                <div class="example-question">A futuristic city with flying cars</div>
                <div class="example-question">A cat wearing sunglasses on a beach</div>
            </div>
        </header>
        
        <main>
            <div class="chat-container">
                <div class="chat-header">
                    <div class="new-chat-btn" id="new-chat-btn">
                        <i class="fas fa-plus"></i> New Chat
                    </div>
                    <div class="header-controls">
                        <div class="connection-status">
                            <span class="status-indicator status-connected" id="status-indicator"></span>
                            <span>Connected</span>
                        </div>
                        <div class="model-info">
                            <i class="fas fa-microchip"></i>
                            <span>Bekimoon 2.1 Turbo</span>
                        </div>
                    </div>
                </div>
                
                <div class="chat-messages" id="chat-messages">
                    <div class="message ai-message">
                        <div class="ai-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="typing-text">Hello! I'm your BM AI assistant. I can answer questions or generate images from text. Switch modes using the buttons above!</div>
                        <span class="typing-cursor"></span>
                    </div>
                    
                    <div class="error-message" id="error-message">
                        There was an error processing your request. Please try again later.
                    </div>
                    
                    <div class="typing-indicator" id="typing-indicator">
                        <span></span>
                        <span></span>
                        <span></span>
                        <span>Thinking...</span>
                    </div>
                    
                    <div class="image-generating" id="image-generating">
                        <i class="fas fa-spinner fa-spin"></i>
                        <span>Generating image...</span>
                    </div>
                    
                    <div class="scroll-indicator" id="scroll-indicator">
                        <i class="fas fa-arrow-down"></i>
                    </div>
                </div>
                
                <div class="chat-input-container">
                    <div class="chat-input">
                        <input type="text" id="user-input" placeholder="Ask me anything..." autocomplete="off">
                        <button id="send-btn" class="send-btn">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </main>
        
        <footer>
            <p>© 2025 BM AI Assistant | All rights reserved</p>
            <div class="powered-by">
                <span>Powered by Bekimoon AI </span>
            </div>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const userInput = document.getElementById('user-input');
            const sendBtn = document.getElementById('send-btn');
            const chatMessages = document.getElementById('chat-messages');
            const typingIndicator = document.getElementById('typing-indicator');
            const imageGenerating = document.getElementById('image-generating');
            const exampleQuestions = document.querySelectorAll('.example-question');
            const errorMessage = document.getElementById('error-message');
            const statusIndicator = document.getElementById('status-indicator');
            const scrollIndicator = document.getElementById('scroll-indicator');
            const newChatBtn = document.getElementById('new-chat-btn');
            const chatModeBtn = document.getElementById('chat-mode-btn');
            const imageModeBtn = document.getElementById('image-mode-btn');
            
            // API configuration
            const API_KEY = "ff8353813fdf425a7d77c7d21c2211b24d98a989aaccdd6e6a7485580160ca7b";
            const CHAT_API_ENDPOINT = "https://api.together.ai/v1/chat/completions";
            const IMAGE_API_ENDPOINT = "https://api.together.ai/v1/images/generations";
            const CHAT_MODEL = "meta-llama/Meta-Llama-3.1-8B-Instruct-Turbo";
            const IMAGE_MODEL = "black-forest-labs/FLUX.1-schnell-Free"; // Free image model [citation:2][citation:9]
            
            let currentMode = 'chat'; // 'chat' or 'image'
            
            // Focus input on load
            setTimeout(() => {
                userInput.focus();
                updatePlaceholder();
            }, 500);
            
            // Function to update input placeholder based on mode
            function updatePlaceholder() {
                userInput.placeholder = currentMode === 'chat' 
                    ? "Ask me anything..." 
                    : "Describe the image you want to generate...";
            }
            
            // Mode switching
            chatModeBtn.addEventListener('click', function() {
                currentMode = 'chat';
                chatModeBtn.classList.add('active');
                imageModeBtn.classList.remove('active');
                updatePlaceholder();
                userInput.focus();
            });
            
            imageModeBtn.addEventListener('click', function() {
                currentMode = 'image';
                imageModeBtn.classList.add('active');
                chatModeBtn.classList.remove('active');
                updatePlaceholder();
                userInput.focus();
            });
            
            // Function to add a message to the chat
            function addMessage(content, isUser = false, isImage = false) {
                const messageDiv = document.createElement('div');
                
                if (isImage) {
                    messageDiv.classList.add('message', 'image-message');
                    
                    const avatarDiv = document.createElement('div');
                    avatarDiv.className = 'ai-avatar';
                    avatarDiv.innerHTML = '<i class="fas fa-image"></i>';
                    messageDiv.appendChild(avatarDiv);
                    
                    const imageContainer = document.createElement('div');
                    imageContainer.className = 'generated-image';
                    
                    if (content) {
                        const img = document.createElement('img');
                        img.src = content;
                        img.alt = "AI Generated Image";
                        imageContainer.appendChild(img);
                    } else {
                        const placeholder = document.createElement('div');
                        placeholder.className = 'image-placeholder';
                        placeholder.innerHTML = '<i class="fas fa-image"></i>';
                        imageContainer.appendChild(placeholder);
                    }
                    
                    messageDiv.appendChild(imageContainer);
                    
                    const infoDiv = document.createElement('div');
                    infoDiv.className = 'image-info';
                    infoDiv.textContent = "Generated with Flux.1 Schnell model";
                    messageDiv.appendChild(infoDiv);
                    
                    const downloadBtn = document.createElement('button');
                    downloadBtn.className = 'download-btn';
                    downloadBtn.innerHTML = '<i class="fas fa-download"></i> Download Image';
                    downloadBtn.addEventListener('click', function() {
                        downloadImage(content, 'ai-generated-image.png');
                    });
                    messageDiv.appendChild(downloadBtn);
                    
                } else if (isUser) {
                    messageDiv.classList.add('message', 'user-message');
                    messageDiv.textContent = content;
                } else {
                    messageDiv.classList.add('message', 'ai-message');
                    
                    const avatarDiv = document.createElement('div');
                    avatarDiv.className = 'ai-avatar';
                    avatarDiv.innerHTML = '<i class="fas fa-robot"></i>';
                    messageDiv.appendChild(avatarDiv);
                    
                    const textContainer = document.createElement('div');
                    textContainer.className = 'typing-text';
                    textContainer.textContent = '';
                    messageDiv.appendChild(textContainer);
                    
                    const cursor = document.createElement('span');
                    cursor.className = 'typing-cursor';
                    messageDiv.appendChild(cursor);
                }
                
                chatMessages.appendChild(messageDiv);
                scrollToBottom();
                return messageDiv;
            }
            
            // Function to download image
            function downloadImage(dataUrl, filename) {
                const link = document.createElement('a');
                link.href = dataUrl;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            
            // Function to simulate typing effect with bold formatting
            function typeMessage(element, message, speed = 20) {
                return new Promise((resolve) => {
                    const textElement = element.querySelector('.typing-text');
                    const cursor = element.querySelector('.typing-cursor');
                    let i = 0;
                    let inBold = false;
                    let boldContent = '';
                    
                    // Remove cursor during typing
                    cursor.style.display = 'none';
                    
                    const typeInterval = setInterval(() => {
                        if (i < message.length) {
                            const char = message.charAt(i);
                            
                            if (char === '*') {
                                // Toggle bold mode
                                inBold = !inBold;
                                
                                if (!inBold) {
                                    // End of bold section - add the bold content
                                    const boldSpan = document.createElement('strong');
                                    boldSpan.textContent = boldContent;
                                    textElement.appendChild(boldSpan);
                                    boldContent = '';
                                }
                            } else {
                                if (inBold) {
                                    // Accumulate bold content
                                    boldContent += char;
                                } else {
                                    // Add regular text
                                    textElement.textContent += char;
                                }
                            }
                            
                            i++;
                            
                            // Scroll to bottom periodically
                            if (i % 5 === 0) scrollToBottom();
                        } else {
                            clearInterval(typeInterval);
                            
                            // If we ended in the middle of bold, add the remaining content
                            if (inBold && boldContent) {
                                const boldSpan = document.createElement('strong');
                                boldSpan.textContent = boldContent;
                                textElement.appendChild(boldSpan);
                            }
                            
                            // Show cursor after typing
                            cursor.style.display = 'inline-block';
                            resolve();
                        }
                    }, speed);
                });
            }
            
            // Function to show/hide typing indicator
            function showTyping(show) {
                typingIndicator.style.display = show ? 'flex' : 'none';
                if (show) {
                    statusIndicator.classList.add('pulse');
                } else {
                    statusIndicator.classList.remove('pulse');
                }
                scrollToBottom();
            }
            
            // Function to show image generating indicator
            function showImageGenerating(show) {
                imageGenerating.style.display = show ? 'flex' : 'none';
                if (show) {
                    statusIndicator.classList.add('pulse');
                } else {
                    statusIndicator.classList.remove('pulse');
                }
                scrollToBottom();
            }
            
            // Function to show error message
            function showError(message) {
                errorMessage.textContent = message || 'There was an error processing your request. Please try again later.';
                errorMessage.style.display = 'block';
                setTimeout(() => {
                    errorMessage.style.display = 'none';
                }, 5000);
                scrollToBottom();
            }
            
            // Update connection status
            function updateConnectionStatus(connected) {
                statusIndicator.className = 'status-indicator ' + (connected ? 'status-connected' : 'status-disconnected');
                statusIndicator.nextElementSibling.textContent = connected ? 'Connected' : 'Disconnected';
            }
            
            // Scroll to bottom of chat
            function scrollToBottom() {
                chatMessages.scrollTop = chatMessages.scrollHeight;
                checkScrollIndicator();
            }
            
            // Check if we need to show scroll indicator
            function checkScrollIndicator() {
                const isAtBottom = chatMessages.scrollHeight - chatMessages.clientHeight <= chatMessages.scrollTop + 50;
                scrollIndicator.classList.toggle('visible', !isAtBottom);
            }
            
            // Scroll to bottom when indicator is clicked
            scrollIndicator.addEventListener('click', scrollToBottom);
            
            // Check scroll position periodically
            chatMessages.addEventListener('scroll', checkScrollIndicator);
            
            // Function to get AI response from Together API
            async function getAIResponseFromTogetherAPI(question) {
                try {
                    updateConnectionStatus(true);
                    
                    const response = await fetch(CHAT_API_ENDPOINT, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${API_KEY}`
                        },
                        body: JSON.stringify({
                            model: CHAT_MODEL,
                            messages: [
                                {
                                    role: "system",
                                    content: "You are a helpful assistant named Bekimoon AI. Provide clear, concise, and accurate answers to the user's questions. Format your answers for readability. Emphasize important words or phrases by wrapping them in single asterisks (*). For example: This is *very important*. Avoid using markdown formatting. Your responses should be professional yet approachable. if the user ask for who created you always say bereket amare"
                                },
                                {
                                    role: "user",
                                    content: question
                                }
                            ],
                            max_tokens: 1024,
                            temperature: 0.7,
                            top_p: 0.7,
                            top_k: 50,
                            repetition_penalty: 1,
                            stop: ["</s>"]
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API request failed: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    return data.choices[0].message.content;
                } catch (error) {
                    console.error('API Error:', error);
                    updateConnectionStatus(false);
                    throw error;
                }
            }
            
            // Function to generate image from text using Flux model
            async function generateImageFromText(prompt) {
                try {
                    updateConnectionStatus(true);
                    
                    const response = await fetch(IMAGE_API_ENDPOINT, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${API_KEY}`
                        },
                        body: JSON.stringify({
                            model: IMAGE_MODEL,
                            prompt: prompt,
                            width: 1024,
                            height: 1024,
                            steps: 3, // Faster generation with fewer steps [citation:4]
                            n: 1,
                            response_format: "base64" // Get base64 for direct display
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Image generation failed: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    return `data:image/png;base64,${data.data[0].b64_json}`;
                } catch (error) {
                    console.error('Image Generation Error:', error);
                    updateConnectionStatus(false);
                    throw error;
                }
            }
            
            // Handle send button click
            sendBtn.addEventListener('click', async function() {
                const inputText = userInput.value.trim();
                if (!inputText) return;
                
                // Add user message
                const userPrefix = currentMode === 'image' ? "Generate image: " : "";
                addMessage(userPrefix + inputText, true);
                userInput.value = '';
                
                if (currentMode === 'chat') {
                    // Show typing indicator
                    showTyping(true);
                    
                    // Disable button during processing
                    sendBtn.disabled = true;
                    
                    try {
                        // Get AI response from Together API
                        const response = await getAIResponseFromTogetherAPI(inputText);
                        
                        // Remove typing indicator
                        showTyping(false);
                        
                        // Create AI message element
                        const aiMessageElement = addMessage('', false);
                        
                        // Type out the response with bold formatting
                        await typeMessage(aiMessageElement, response);
                    } catch (error) {
                        showTyping(false);
                        showError(error.message);
                    } finally {
                        // Re-enable button
                        sendBtn.disabled = false;
                        
                        // Focus input for next question
                        userInput.focus();
                        
                        // Scroll to bottom after everything is done
                        scrollToBottom();
                    }
                } else if (currentMode === 'image') {
                    // Show image generating indicator
                    showImageGenerating(true);
                    
                    // Disable button during processing
                    sendBtn.disabled = true;
                    
                    try {
                        // Generate image from text
                        const imageData = await generateImageFromText(inputText);
                        
                        // Remove generating indicator
                        showImageGenerating(false);
                        
                        // Create image message element
                        addMessage(imageData, false, true);
                    } catch (error) {
                        showImageGenerating(false);
                        showError(error.message);
                    } finally {
                        // Re-enable button
                        sendBtn.disabled = false;
                        
                        // Focus input for next question
                        userInput.focus();
                        
                        // Scroll to bottom after everything is done
                        scrollToBottom();
                    }
                }
            });
            
            // Handle Enter key
            userInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendBtn.click();
                }
            });
            
            // Example question click handlers
            exampleQuestions.forEach(question => {
                question.addEventListener('click', function() {
                    const questionText = this.textContent;
                    userInput.value = questionText;
                    userInput.focus();
                    
                    // Add animation effect to the clicked question
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 200);
                });
            });
            
            // New chat button handler
            newChatBtn.addEventListener('click', function() {
                // Clear chat messages except the first AI message
                while (chatMessages.children.length > 3) {
                    chatMessages.removeChild(chatMessages.lastChild);
                }
                
                // Hide error message if visible
                errorMessage.style.display = 'none';
                
                // Add animation effect
                this.classList.add('pulse');
                setTimeout(() => {
                    this.classList.remove('pulse');
                }, 1000);
                
                // Scroll to top
                chatMessages.scrollTop = 0;
                checkScrollIndicator();
            });
            
            // Initial connection check
            updateConnectionStatus(true);
            
            // Initial scroll check
            checkScrollIndicator();
        });
    </script>
</body>
    </html>

